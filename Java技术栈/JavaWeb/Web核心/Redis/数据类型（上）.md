本节我们来学习Redis的数据类型

- 数据类型简介

我们首先要了解下哪些数据我们要置于我们的Redis中，具体请看下图，下图中的信息就是要放置到我们的Redis中的

![](D:/Rolin的学习笔记/youdaonote-pull/youdaonote/youdaonote-images/WEBRESOURCE7962a7d0b9406d2ac48c41e1cb93a762.png)

最后我们的Redis的数据类型总结出来五种，分别是string、hash、list、set以及zset，最后一种zset的使用场景很少，所以我们这里就不重点学习了，提一提就差不多得了

![](D:/Rolin的学习笔记/youdaonote-pull/youdaonote/youdaonote-images/WEBRESOURCE0710ba918210bbfad0757f8c5e657c4d.png)

- String基本操作

在正式学习String之前，我们要先学习redis的数据存储格式，我们都知道redis自身是一个Map，其下所有的数据都是采用key：value的形式来存储的，那么其数据类型就是指value的部分，key部分永远都只是字符串

![](D:/Rolin的学习笔记/youdaonote-pull/youdaonote/youdaonote-images/WEBRESOURCE1221e98212b83234412ff9a202c82658.png)

接着来我们具体说说string类型，其一般使用字符串来保存数据，但是如果字符串是以整数的形式展示，那么也可以作为数字操作使用

![](D:/Rolin的学习笔记/youdaonote-pull/youdaonote/youdaonote-images/WEBRESOURCE73d01fd22e5687d5313879b695b14bdc.png)

接着我们正式来学习string类型的数据操作，set和get以及del就不多说了，这个很好理解。这里值得重点一提的是setnx，其也是用于设置的命令，但是其会返回一个布尔类型的结果，如果一开始我们的key和value都没有被设置，那么其会正确添加并返回1，代表成功。但是如果我们尝试覆盖，在一个已经有值的key上添加值，那么就会返回0，代表不成功

![](D:/Rolin的学习笔记/youdaonote-pull/youdaonote/youdaonote-images/WEBRESOURCEe6081d15e92b5a2593ddd060cc8bbde6.png)

接着是批量添加和批量获取，分别是mset和mget，我们也可以通过strlen命令，输入对应的key获取我们的对应的value的字符串长度，然后是append key value，这个命令是将信息追加到我指定的信息的后面，如果原始信息压根就没有那么就直接创建

![](D:/Rolin的学习笔记/youdaonote-pull/youdaonote/youdaonote-images/WEBRESOURCEf560df7402fab0c4ff6281bb6ebb3416.png)

最后我们要解决一个问题，那就是我们到底要用单个添加还是多个添加比较好，实际的测试结果是，如果我们要添加的数据比较少，那么使用单个添加还是批量添加都是可以的，但是如果我们要添加的数据比较多，那么我们就应该选择批量添加

![](D:/Rolin的学习笔记/youdaonote-pull/youdaonote/youdaonote-images/WEBRESOURCE638b2d01a120983da9bcaab136d70015.png)

- string扩展操作

接下来我们学习string的扩展操作，首先是incr，这个简单可以理解为i++，会将我们指定的值+1，当然，这个前提是这个值的确是int类型或是可以被转换为int类型的，而incrby则是可以指定每次增长的值，incrbyfloat则是可以对小数操作。decr则反之，这个不多提了。setex是可以设置我们的数据一定时间的生命周期，这里生命周期的时间是以秒来设计的。这里的操作常常用在我们的验证码中，比如说我们设置一个数据，设置五分钟内有效，这就是验证码经常的一种使用情况了，这也对应了我们之前说的验证码常放在我们的redis中的知识。而psetex的作用和我们的一样的，只不过这里的秒数变成了毫秒而已

![](D:/Rolin的学习笔记/youdaonote-pull/youdaonote/youdaonote-images/WEBRESOURCEf0d7e98d2453f432261944238385d225.png)

最后关于string类型的数据操作我们还有一些注意事项要看，具体请看下图

![](D:/Rolin的学习笔记/youdaonote-pull/youdaonote/youdaonote-images/WEBRESOURCEf9a11785753cbdd34995248a6902c0c4.png)

- string应用场景与key命名约定

比如说我们微博中的大V，那么其粉丝数量，博客数量那些要优先加载而且总是更新的数据，我们都是放在redis中的，我们往里面添加用户信息的时候，我们可以用用户主键和属性值作为key，然后后来设定定时刷新策略。当然，我们也可以使用json格式保存数据，这里就不再演示了

![](D:/Rolin的学习笔记/youdaonote-pull/youdaonote/youdaonote-images/WEBRESOURCEe777d0cadb4932464d61fa8beda10be9.png)

最后我们说下我们key的命名约定，一般我们是以表明：主键名：主键值来命名一个key的，如果说其下还有字段的不同，那么我们还可以在后续再设置上一个字段名上去

![](D:/Rolin的学习笔记/youdaonote-pull/youdaonote/youdaonote-images/WEBRESOURCE3f32c5210645363621ef574cdf397414.png)

- hash的基本操作

下面我们来学习第二个数据类型，hash。在学习hash之前，我们先来介绍下什么是hash。我们之前介绍过json的存储的方式，其可以将数据封装为类似于是一个对象，这样很多数据都可以放一块，便于管理，但是相应的，这种存储方式却让我们的数据更新变得繁琐，比如说我们要更新一个数据的话，我们需要将所有数据更一起更新一遍，哪怕其他数据其实没有发生变化。

这时我们的一个解决方式就是将我们的各种数据分开存储，此时我们会发现这些数据的key部分都是一样的，只是最后一段有所不同而已，而且我们仍然期待有一种方式可以将这些数据封装到一起，而更新数据时又不必一起更新，此时就轮到hash登场了。hash可以将这些数据封装到一起，称为一个hash，不同的字段列我们成为field，也就是属性，其有对应的value值。

![](D:/Rolin的学习笔记/youdaonote-pull/youdaonote/youdaonote-images/WEBRESOURCE8492c1c50909f9b022b19d1769d300d9.png)

下面是对于hash类型的图示介绍，其底层是使用哈希表结构实现数据存储。这里有一点值得一提，那就是如果field的数量较少，存储结构将优化为类数组结构，而如果field数量较多，存储结构将使用HashMap结构

![](D:/Rolin的学习笔记/youdaonote-pull/youdaonote/youdaonote-images/WEBRESOURCE8d65b3a098ce3aa85a0704c167cc7a7d.png)

接下来我们来学习hash数据类型的基本操作，其实这里很多是非常类似我们之前学习过的操作的，只不过的命令名称有所变化罢了，还有在Hash里是要添加上field字段的后跟值的。添加以及修改数据是hset，而获取数据是hget，其还提供了hgetall，获得hash里所有数据的命令，当然还有删除数据的hdel，最后是hsetnx，该命令可以设置field的值，如果field已经存在值了则不做任何变动

![](D:/Rolin的学习笔记/youdaonote-pull/youdaonote/youdaonote-images/WEBRESOURCE5936120ada91652fc14cd046d74aa0e5.png)

批量添加的命令是hmset，批量获得是hmget，hlen可以获得哈希表中字段的数量，也就是field的数量，hexists可以判断哈希表中是否有指定的字段

![](D:/Rolin的学习笔记/youdaonote-pull/youdaonote/youdaonote-images/WEBRESOURCE693e8e74f8ddd2a41bfb95c013e556e3.png)

这里特别要提一下hgetall方法，该方法可以获取到hash表中的所有数据，其表示方式是先展示字段，后展示字段的value值，如下图所示，也可以理解为奇数展示字段，偶数展示值

![](D:/Rolin的学习笔记/youdaonote-pull/youdaonote/youdaonote-images/WEBRESOURCEa4b62ef63208972c594d0597d3838839.png)

- hash扩展操作

hash的扩展操作有hkeys和hvals，前者可以获取哈希表中所有的字段名，后者可以获取哈希表中所有的字段值

而hincrby可以设置指定字段，令其增加具体范围的值，如果希望其减少的话，那么只要指定其增加一个负数就行了，而hincrbyfloat则是可以指定小数的值

![](D:/Rolin的学习笔记/youdaonote-pull/youdaonote/youdaonote-images/WEBRESOURCEa9e0e864364fd6c64dca7c502bd4c8de.png)

最后我们来看hash类型数据操作时的注意事项，首先hash类型中的value只能存储字符串类型，不能存储其他属性，同时不允许hash嵌套hash，别整天想着嵌套的骚操作啊。然后是hash类型虽然十分贴切对象的数据存储形式，很好用，但是其设计初中并不是为了存储大量对象而设计的，因此我们不可滥用，别有个数据就直接往hash里放，总体来说hash用的还是比较少的，更多时候我们都是使用string，只要用得好就行。最后hgetall操作可以获得全部属性，但是如果内部field太多，那么整体的效率就会很低，所以我们平时要尽量小心使用这个命令

![](D:/Rolin的学习笔记/youdaonote-pull/youdaonote/youdaonote-images/WEBRESOURCE6f6de4547684d2f8108796ccc0922f6a.png)

- hash的应用场景

hash的一个简单的应用场景就是手机移动卡的充值，比如说我们电信推出了30、50、100的抢购活动，每种商品上钩的上限是1000张，那么我们就可以构建一个hash表，其中我们的30、50、100是我们的field字段，而数量则是我们value的值，卖多少就调用相关的hincrby命令

![](D:/Rolin的学习笔记/youdaonote-pull/youdaonote/youdaonote-images/WEBRESOURCEd96995ee64f800221d77e80b4715f05f.png)

我们来看看实现的步骤

![](D:/Rolin的学习笔记/youdaonote-pull/youdaonote/youdaonote-images/WEBRESOURCE56124df73c9abcf5a9f84cdd7c3cb090.png)

这里有一点需要注意的，那就是实际的项目里还有超卖的问题存在，比如说我们明明只剩下3张了，给我卖了五张，那肯定不行啊，但是我们这里就不考虑这个问题了，这个问题等到我们以后做项目的时候再考虑