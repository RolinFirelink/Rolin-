学习完了基本的语法之后，我们现在来实现一个搜索联想的案例

- 案例效果和环境的介绍

案例的内容很简单，就是实现一个模糊搜索

![](D:/Rolin的学习笔记/youdaonote-pull/youdaonote/youdaonote-images/WEBRESOURCEa8e901a629ae31f804a98c319a4bc773.png)

- 案例的实现

先来看看我们实现案例的步骤

![](D:/Rolin的学习笔记/youdaonote-pull/youdaonote/youdaonote-images/WEBRESOURCE5dc1bb3daba6f2d0a401db5b74c25950.png)

然后我们要知道，我们的案例只需要我们实现对应的页面代码和服务器的处理代码，其他的代码都已经事先帮我们做好了。我们这里先贴出来

先看看我们的案例的包的分层格式

![](D:/Rolin的学习笔记/youdaonote-pull/youdaonote/youdaonote-images/WEBRESOURCE6b00f103774be99b5917e1311b03b0f4.png)

首先是我们创建对应的数据的sql代码

```
-- 创建db10数据库
        CREATE DATABASE db10;

        -- 使用db10数据库
        USE db10;

        -- 创建user表
        CREATE TABLE USER(
        id INT PRIMARY KEY AUTO_INCREMENT, -- 主键id
        NAME VARCHAR(20),        -- 姓名
        age INT,            -- 年龄
        search_count INT                        -- 搜索数量
        );

        -- 插入测试数据
        INSERT INTO USER VALUES (NULL,'张三',23,25),(NULL,'李四',24,5),(NULL,'王五',25,3)
        ,(NULL,'赵六',26,7),(NULL,'张三丰',93,20),(NULL,'张无忌',18,23),(NULL,'张强',33,21),(NULL,'张果老',65,6);
```

然后是我们的连接的代码config.properties，这个代码只放一个格式，具体内容还需要我们进行更改

```
driver=com.mysql.jdbc.Driver
url=jdbc:mysql://192.168.59.143:3306/db10
username=root
password=itheima
```

然后是log4j日志文件的固定代码

```
# Global logging configuration
log4j.rootLogger=DEBUG, stdout
# Console output...
log4j.appender.stdout=org.apache.log4j.ConsoleAppender
log4j.appender.stdout.layout=org.apache.log4j.PatternLayout
log4j.appender.stdout.layout.ConversionPattern=%5p [%t] - %m%n
```

然后是我们的Mybatis的核心配置文件

```
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-config.dtd">
<!--configuration：核心根标签-->
<configuration>

    <!--引入数据库连接信息配置文件-->
    <properties resource="config.properties"/>

    <!--集成LOG4J日志信息-->
    <settings>
        <setting name="logImpl" value="log4j"/>
    </settings>

    <!--配置数据库环境，可以有多个。default指定默认使用哪个-->
    <environments default="mysql">
        <!--配置环境，id是唯一标识-->
        <environment id="mysql">
            <!--事务管理 采用JDBC默认的事务-->
            <transactionManager type="JDBC" />
            <!--数据源：连接池-->
            <dataSource type="POOLED">
                <!--获取数据库连接相关配置-->
                <property name="driver" value="${driver}"/>
                <property name="url" value="${url}"/>
                <property name="username" value="${username}"/>
                <property name="password" value="${password}"/>
            </dataSource>
        </environment>
    </environments>

    <!--配置映射关系-->
    <mappers>
        <!--接口所在的包-->
        <package name="com.itheima.mapper"/>
    </mappers>

</configuration>
```

接着是模糊查询的代码，这里我们要注意我们如果在sql中使用字符串的拼接，就要使用CONCAT字符串

```
package com.itheima.mapper;

import com.itheima.bean.User;
import org.apache.ibatis.annotations.Select;

import java.util.List;

public interface UserMapper {
    /*
        模糊查询
     */
    @Select("SELECT * FROM user WHERE name LIKE CONCAT('%',#{username},'%') ORDER BY search_count DESC LIMIT 0,4")
    public abstract List<User> selectLike(String username);
}

```

然后是我们的模糊查询的具体的实现类的代码，当然，这里还有一个接口的才是，但是我们这里就不放出来了

```
package com.itheima.service.impl;

import com.itheima.bean.User;
import com.itheima.mapper.UserMapper;
import com.itheima.service.UserService;
import org.apache.ibatis.io.Resources;
import org.apache.ibatis.session.SqlSession;
import org.apache.ibatis.session.SqlSessionFactory;
import org.apache.ibatis.session.SqlSessionFactoryBuilder;

import java.io.IOException;
import java.io.InputStream;
import java.util.List;

public class UserServiceImpl implements UserService {
    @Override
    public List<User> selectLike(String username) {
        List<User> users = null;
        SqlSession sqlSession = null;
        InputStream is = null;
        try{
            //1.加载核心配置文件
            is = Resources.getResourceAsStream("MyBatisConfig.xml");
            //2.获取SqlSession工厂对象
            SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(is);
            //3.通过SqlSession工厂对象获取SqlSession对象
            sqlSession = sqlSessionFactory.openSession(true);
            //4.获取UserMapper接口的实现类对象
            UserMapper mapper = sqlSession.getMapper(UserMapper.class);
            //5.调用实现类对象的模糊查询方法
            users = mapper.selectLike(username);
        }catch (Exception e) {
            e.printStackTrace();
        }finally {
            //6.释放资源
            if(sqlSession != null) {
                sqlSession.close();
            }
            if(is != null) {
                try {
                    is.close();
                } catch (IOException e) {
                    e.printStackTrace();
                }
            }
        }
        //7.返回结果到控制层
        return users;
    }
}

```

然后是我们的页面本身的参数，这里还有其他的一些图片的内容，这里就不一一放出来了

到这里为止我们就可以正式来实现我们的案例了，首先我们要创建对应的User类，我们将其放置于bean包下

```
package com.itheima.bean;
/*
    用户的实体类
 */
public class User {
    private Integer id;              // 主键id
    private String name;             // 姓名
    private Integer age;             // 年龄
    private Integer search_count;   //搜索数量

    public User() {
    }

    public User(Integer id, String name, Integer age, Integer search_count) {
        this.id = id;
        this.name = name;
        this.age = age;
        this.search_count = search_count;
    }

    public Integer getSearch_count() {
        return search_count;
    }

    public void setSearch_count(Integer search_count) {
        this.search_count = search_count;
    }

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public Integer getAge() {
        return age;
    }

    public void setAge(Integer age) {
        this.age = age;
    }


}

```

然后我们在对应的controller包里写入我们的服务器端处理用户发送的请求的代码

```
package com.itheima.controller;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.itheima.bean.User;
import com.itheima.service.UserService;
import com.itheima.service.impl.UserServiceImpl;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.util.List;

@WebServlet("/userServlet")
public class UserServlet extends HttpServlet {
    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        //设置请求和响应的编码
        req.setCharacterEncoding("UTF-8");
        resp.setContentType("text/html;charset=UTF-8");

        //1.获取请求参数
        String username = req.getParameter("username");

        //2.调用业务层的模糊查询方法得到数据
        UserService service = new UserServiceImpl();
        List<User> users = service.selectLike(username);

        //3.将数据转成JSON，响应到客户端
        ObjectMapper mapper = new ObjectMapper();
        String json = mapper.writeValueAsString(users);
        resp.getWriter().write(json);
    }

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        doPost(req,resp);
    }
}

```

我们这里的处理就是获得其请求的参数，然后调用业务层的模糊查询方法得到我们的数据，这个数据是一个List集合，然后将其转换为JSON格式之后直接响应到用户的浏览器中

最后我们在界面中做对应的处理，我们可以写入其代码如下

```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>用户搜索</title>
    <style type="text/css">
        .content {
            width: 643px;
            margin: 100px auto;
            text-align: center;
        }

        input[type='text'] {
            width: 530px;
            height: 40px;
            font-size: 14px;
        }

        input[type='button'] {
            width: 100px;
            height: 46px;
            background: #38f;
            border: 0;
            color: #fff;
            font-size: 15px
        }

        .show {
            position: absolute;
            width: 535px;
            height: 100px;
            border: 1px solid #999;
            border-top: 0;
            display: none;
        }
    </style>
</head>
<body>
<form autocomplete="off">
    <div class="content">
        <img src="img/logo.jpg">
        <br/><br/>
        <input type="text" id="username">
        <input type="button" value="搜索一下">
        <!--用于显示联想的数据-->
        <div id="show" class="show"></div>
    </div>
</form>
</body>
<script src="js/jquery-3.3.1.min.js"></script>
<script>
    //1.为用户名输入框绑定鼠标点击事件
    $("#username").mousedown(function () {
        //2.获取输入的用户名
        let username = $("#username").val();

        //3.判断用户名是否为空
        if(username == null || username == "") {
            //4.如果为空，将联想框隐藏
            $("#show").hide();
            return;
        }

        //5.如果不为空，发送AJAX请求。并将数据显示到联想框
        $.ajax({
            //请求的资源路径
            url:"userServlet",
            //请求参数
            data:{"username":username},
            //请求方式
            type:"POST",
            //响应数据形式
            dataType:"json",
            //请求成功后的回调函数
            success:function (data) {
                //将返回的数据显示到show的div
                let names = "";
                for(let i = 0; i < data.length; i++) {
                    names += "<div>"+data[i].name+"</div>";
                }
                $("#show").html(names);
                $("#show").show();
            }
        });
    });


</script>
</html>
```

上面50行之后的代码才是我们所需要的代码，之前的代码都是帮我们事先写好的样式控制。这里值得一提的是，由于我们传入的json的数据是由集合转换过来的，实际上我们在页面了处理响应的数据时，其会自动将json数据转换为一个集合，因此我们可以用集合来处理这个data对象，来具体控制我们想要其添加的位置和显示的地方

最后我们放上该案例的源码压缩包，需要自取

