我们可以看到在我们的src下有以下各种不同的包，其每一个包都有其独特的作用

![](D:/Rolin的学习笔记/youdaonote-pull/youdaonote/youdaonote-images/WEBRESOURCEcd76ffd7276fdfd59f1221e713cbc1f2.png)

bean包下存放实体类的包

global包下存放一些全局使用的类

media.img存放一些图片

module存放界面相关的类

service存放服务相关类

theme存放美化界面相关的文件

App则是主类，是我们启动程序的地方



关于bean包下的实体类

我们点入bean包，可以看到其存放有以下类，那么什么是实体类呢？

![](D:/Rolin的学习笔记/youdaonote-pull/youdaonote/youdaonote-images/WEBRESOURCE0c543e9fedc313ddcf7449a0cbc0c512.png)

比方说我们要在我们的图书管理系统里生成一本书，那么该书肯定是一个对象，这个对象就是book，实际上，我们点进去book里，也可以看到book里存放的字节码文件里写的内容是关于书对象的

同类还有管理员对象，借阅对象，以及用户对象，每当我们在系统里操作对应的操作时，底部代码都会创建对应的对象并保存下来，这里有一个Constant常量，这个关于常量的内容我们就用到的时候再来科普



关于global和media.img包

这两个包的内容实际我们开发的时候基本用不到，就不讲了，前者主要是用于提供界面的，后者则是提供界面所需要的图片



关于module包

该包的中文意思是模块，存放的是对应界面的文件，里面的每一个包都相当于是一个界面，里面存放了对应界面操作的代码，我们的图书馆管理系统里有图书管理，借阅管理和用户管理三个界面，那么这三个界面我们就可以看成是三个模块，那么在我们的module类里就提供了这三个界面模块的对应的操作代码

比方说对于module包下的book包而言，book包对应的是图书管理里的各种操作和界面，我们如果想要添加或者删除图书，都会弹出对应的指令窗口，这些指令窗口必然也是有其对应的代码的，这些代码就是全部放到了book包下了

在module包下的各个包都对着不同的界面窗口，比如charts对应的是我们主界面里的图书统计，dashboard对应的是主页，而lend对应的是借阅相关的代码，user则是用户管理的相关代码，最后是login，其里面存放登录相关的界面代码

module包下就是利用了分层的思想，将一个大模块分层一个个小模块，便于我们代码的维护和升级

![](D:/Rolin的学习笔记/youdaonote-pull/youdaonote/youdaonote-images/WEBRESOURCE7b315e2cf73942cbe8060b6fc77d342f.png)



关于service包

service代表的意思是服务，这是我们经常要用到的一个类

![](D:/Rolin的学习笔记/youdaonote-pull/youdaonote/youdaonote-images/WEBRESOURCE9ed189a3b77a22d1b095ec3c87ff8e2d.png)

点开service包里我们可以看到一个AdminService接口，我们不妨来看看接口内的代码

```javascript
public interface AdminService {

    Admin get(String name);

    void save(Admin admin);

}
```

可以看到接口内只有两个方法，一个是获取用户的名字，一个是保存用户的名字，所有继承了AdminService接口类的类都代表其能够提供一个获取用户名和保存用户名的一个服务的意思，这个我们后续用到的时候再来具体讲讲，这里先粗略理解下也无妨



关于theme包

theme包下存储的界面相关的类，其主要的作用是用于美化界面的

![](D:/Rolin的学习笔记/youdaonote-pull/youdaonote/youdaonote-images/WEBRESOURCEc9d1be6dcecf541f1e97ab790f8ab6ca.png)

theme包下的css包下的内容就是美化相关的字节码文件，可以将其比作是我们穿的衣服，我们的程序要有合适的css文件，这样我们的程序才会变得美观，以后学了前端的话会对其进行更深一步的学习

fonts包下的内容则是字体，skin包下则是皮肤，我们可以在skin包下设计对应的代码，让我们的界面展示的风格变得不同

实际上，我们未来也不会对theme包下做什么修改，至少我们这个项目不会



App类

该类就是一个含有main方法的类，是我们程序启动的位置



登录功能代码分析

那么现在我们来分析下我们的登录功能的代码是如何实现的，我们都知道我们要实现登录是要进入App类中手动执行main方法然后进入登录的，登录之后我们能够看到对应的界面，因此我们要分析登录界面的代码，自然就要从App类中入手，先从头看

```javascript
import javafx.application.Application;
public class  App extends Application {
```

可以看到该类继承了一个Application类，该类其实就是java FX的Application类，主要作用是用于构建我们所需要的界面

接着我们往下看，我们可以看到这样的代码

```javascript
@Override
public synchronized void init(){
    section = SectionManager.get();

    AdminService adminService = new AdminServiceImpl();

    if(section.isLogged()){
        admin = adminService.get(section.getUserLogged());
        adminDetail = new AdminDetail(section.getUserLogged(), admin.getUserName(), "subtitle");
    } else {
        adminDetail = new AdminDetail();
    }

    float total = 43; // the difference represents the views not loaded
    increment = 100f / total;

    load("book", "BookView");
    load("book", "BookHandleView");
    load("book", "BookLendView");

    load("user","UserView");
    load("user","UserHandleView");
    load("user","UserSelectView");
    load("user","UserChargeView");

    load("lend","LendView");
    load("lend","LendHandleView");

    load("dashboard", "dashboard");

    load("charts", "piechart");

    load("main",     "main");

    load("profile", "profile");

    load("login", "login");
    load("login", "account");

    // delay
    try {
        wait(300);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
}
```

这个init方法，我们先不看前面的内容，主要来看其各种load方法，可以看到在init方法中调用了多次load方法，而且传入的都是我们所熟悉的book，login，user，charts，都是我们之前学习过的module包下的各种模板包，我们又知道load是加载的意思，那么会不会这个方法其代表的实质意义其实是将各种界面模块给预先加载进来呢？为了确认这个想法，我们要进入到load方法中实际看看其代码

我们点进去可以看到如下代码

```javascript
private void load(String module, String name){
    try {
        ViewManager.getInstance().put(
                name,
                FXMLLoader.load(getClass().getResource("/com/bjpowernode/module/" + module + "/" + name + ".fxml"))
        );
        preloaderNotify();
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

这个load方法本身也是在App类下的，我们可以看到在这个方法里调用了put方法，然后将name传入，并且将module和name在put方法里再次传入，put方法显然就是添加的意思，但是为什么这里可以调用put方法呢？其实这是因为ViewManager.getInstance()本身是一个Map集合，而Map集合里有put方法，因此可以调用，我们不妨进入其内部看看

```javascript
public class ViewManager {

    private static ViewManager instance;
    private static final HashMap<String, Node> SCREENS = new HashMap<>();
    private static String nameView;

    private ViewManager(){}

    public static ViewManager getInstance() {
        if(instance == null){
            instance =  new ViewManager();
        }
        return instance;
    }

    public void put(String name, Node node){
        nameView = name;
        SCREENS.put(name, node);
    }
```

可以看到，在ViewManager中，是存放有HashMap类的，而该类定义了泛型String和Node，其底层是使用了HashMap并且提供了getInstance方法，值得一提的是这里我们getInstance是懒汉式的，也就是线程不安全的，但是这里没有关系，因为我们这里只使用每次登入登出都只有一个用户，因此不涉及多线程，所以这里即使是线程不安全的懒汉式也没问题。但如果涉及到多线程的话，我们就应该使用线程安全的饿汉式代码

在该类中还挺了put方法，put方法里会将名字赋予给nameView，也就是当前对象的变量，且其中还调用了Map类中的put方法，将名字和Node结点存入到Map集合当中

那么这样我们就解决了put方法的疑问，我们接下来来理解前一个代码块的第五行的代码，首先让我们来重新看看这一行的代码

```javascript
ViewManager.getInstance().put(
        name,
        FXMLLoader.load(getClass().getResource("/com/bjpowernode/module/" + module + "/" + name + ".fxml"))
);
```

可以看到，这里我们也调用了load加载方法，而我们之前说过module是我们此前所说的模块类，因此这里做了字符串的拼接，将具体的包都定义在模块包下，当然这里具体是什么包取决于我们传入的module是什么，因为我们的module包下有各种不同的子模块包，具体是什么包取决于我们到底是要加载哪个包，而后面的name我们可以看到其拼接了一个fxml字符串，总体来看，我们可以确定这行代码的作用是将对应的fxml文件给加载进来，我们这里进行了字符串的拼接就是为了准确定位到对应的fxml文件路径，便于将其加载进来

那么了解了这些之后，我们就可以理解load方法的意义了，其第一传入的是模块包下的子模块的包名，而第二个传入的包下的对应fxml的文件名，我们将这两个文件传入之后，其内部会将对应的fxml文件给载入进去

![](D:/Rolin的学习笔记/youdaonote-pull/youdaonote/youdaonote-images/WEBRESOURCEdd4ee932b515d1388e31046f28077717.png)

那么这个fxml的文件有什么作用呢？其实这个fxml文件就是跟我们的布局有关系的，比方说我们登录的布局，为什么是现在这样的样子呢？这其实就是fxml文件的功劳，如果我们想要改变这个布局，我们可以通过改变其中的fxml文件来进行实现

这个fxml文件我们将来工作的时候用不太到，因此这里就不多做介绍了，只做简单的了解就好，我们这里就以BookHandleView.fxml为例来进行对fxml文件的了解

请看该fxml文件的代码：

```javascript
<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.collections.FXCollections?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import java.lang.String?>
<?import java.net.*?>
<StackPane prefHeight="620.0" prefWidth="500.0" xmlns="http://javafx.com/javafx/8" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.bjpowernode.module.book.BookHandleViewCtrl">
    <children>
        <VBox alignment="CENTER" spacing="10.0">
            <children>
                <VBox alignment="CENTER" spacing="20.0" styleClass="box-light" VBox.vgrow="ALWAYS">
                    <children>
                          <GridPane alignment="CENTER" prefWidth="478.0" hgap="10" vgap="10">
                              <children>
                                  <Label GridPane.columnIndex="0" GridPane.rowIndex="8" prefHeight="30.0" prefWidth="60.0" style="-fx-text-fill: -text-color;" />
                                  <TextField fx:id="bookIdField" GridPane.columnIndex="1" GridPane.rowIndex="9"  visible="false" layoutX="739.0" layoutY="18.0" prefHeight="30.0" prefWidth="151.0" styleClass="rectangle" />
                                  <Label GridPane.columnIndex="0" GridPane.rowIndex="0" prefHeight="30.0" prefWidth="60.0" style="-fx-text-fill: -text-color;" text="书名:" />
                                  <TextField fx:id="bookNameField"  GridPane.columnIndex="1" GridPane.rowIndex="0" layoutX="739.0" layoutY="18.0" prefHeight="30.0" prefWidth="151.0" promptText="书名" styleClass="rectangle" />
                                  <Label GridPane.columnIndex="0" GridPane.rowIndex="1" prefHeight="30.0" prefWidth="60.0" style="-fx-text-fill: -text-color;" text="isbn:" />
                                  <TextField fx:id="isbnField" GridPane.columnIndex="1" GridPane.rowIndex="1" prefHeight="30.0" prefWidth="151.0" promptText="isbn" styleClass="rectangle" />
                                  <Label GridPane.columnIndex="0" GridPane.rowIndex="2" prefHeight="30.0" prefWidth="60.0" style="-fx-text-fill: -text-color;" text="作者:" />
                                  <TextField fx:id="authorField" GridPane.columnIndex="1" GridPane.rowIndex="2" prefHeight="30.0" prefWidth="151.0" promptText="作者" styleClass="rectangle" />
                                  <Label GridPane.columnIndex="0" GridPane.rowIndex="3" prefHeight="30.0" prefWidth="60.0" style="-fx-text-fill: -text-color;" text="出版社:" />
                                  <TextField fx:id="publisherField" GridPane.columnIndex="1" GridPane.rowIndex="3" prefHeight="30.0" prefWidth="151.0" promptText="出版社" styleClass="rectangle" />
                                  <Label GridPane.columnIndex="0" GridPane.rowIndex="4" prefHeight="30.0" prefWidth="60.0" style="-fx-text-fill: -text-color;" text="类型:" />
                                  <ComboBox fx:id="typeField" GridPane.columnIndex="1" GridPane.rowIndex="4" prefHeight="30.0" prefWidth="179.0" >
                                      <items>
                                          <FXCollections fx:factory="observableArrayList" >
                                              <String fx:value="计算机" />
                                              <String fx:value="文学" />
                                              <String fx:value="经济" />
                                              <String fx:value="管理" />
                                          </FXCollections>
                                      </items>
                                      <value>
                                          <String fx:value="计算机"/>
                                      </value>
                                  </ComboBox>
                              </children>
                          </GridPane>

                         <HBox alignment="CENTER" prefHeight="100.0" prefWidth="478.0" spacing="10.0">
                             <children>
                                 <Button mnemonicParsing="false" prefHeight="54.0" prefWidth="100.0" onMouseClicked="#addOrEditBook" styleClass="btn-primary" text="提交" />
                                 <Button layoutX="406.0" layoutY="10.0" mnemonicParsing="false" prefHeight="54.0" prefWidth="100.0" onMouseClicked="#closeView" styleClass="btn-info" text="关闭" />
                             </children>
                         </HBox>
                    </children>
                </VBox>
            </children>
            <padding>
                <Insets bottom="10.0" left="30.0" right="30.0" top="30.0" />
            </padding>
        </VBox>
    </children>
    <stylesheets>
        <URL value="@../../theme/css/material-color.css" />
        <URL value="@../../theme/css/skeleton.css" />
        <URL value="@../../theme/css/light.css" />
        <URL value="@../../theme/css/bootstrap.css" />
        <URL value="@../../theme/css/simple-green.css" />
        <URL value="@../../theme/css/shape.css" />
        <URL value="@../../theme/css/typographic.css" />
        <URL value="@../../theme/css/helpers.css" />
        <URL value="@../../theme/css/master.css" />
    </stylesheets>
</StackPane>

```

虽然这是前端的内容，但是这里最前面的内容即使没有学过前端知识我们也知道这是导包

我们可以看到第15行和第42行，可以看到这里分别有两个标签，名字上虽然差不多，但是后者的前头带着/，前者则没有，这里其实这两个共同构成了一个类的开始和结束，带着/的标志着这个类的结束，这里的标签总是成对出现的，而且标签名不是随意写的，是根据一些类的类名写的

但是我们可以看到第46行，这行就没有结束标签，这是怎么回事呢？我们可以认真看看46行的结尾，会发现其在结尾处有一个/，这样的写法其实就相当于是上面介绍的方式，有两个标签，只是用这种写法省略的结束标签，而只是用/代替而已

然后是标签里还可以写标签，其代表的意义是这个标签里的内容包含着另一个标签的内容，这其实很好理解

最后标签后面带有的各种内容我们称之为属性，界面的具体布局就是通过调控这个属性来实现的

然后我们看看58行到68行，这一行里引入了很多css文件，此前我们讲过css文件就相当于是衣服，那么这十行代码的作用就相当于是给我们的项目穿上衣服，令其整体变得更加漂亮

那么对于fxml文件的内容我们就先介绍到此，后续我们讲到其他的fxml文件的时候，我们再来进行具体介绍

那么到此为止，我们的load方法的所有内容就讲完了，我们现在知道load方法其实就是加载各种fxml文件，每个fxml文件又对应一个界面，先调用许多load文件将界面生成并存放到Map集合中，当我们的程序的页面需要变换时，我们就是通过直接从Map集合中去取来达成我们的目的的

讲完了load方法之后，我们来具体看看登录功能是如何实现的，先来看看代码

```javascript
public  void start(Stage primary) {

    configServices();
    initialScene();
```

其实下面还有代码，但是为了界面整洁就省略了，这里我们最重要的是来看第四行代码，可以看到第四行代码调用了initialScene方法，我们不妨点进去看看该方法的源码

```javascript
    private void initialScene(){

        decorator.setTitle("ͼ�����");
//        decorator.setIcon(null);
        decorator.addButton(ButtonType.FULL_EFFECT);
        decorator.initTheme(GNDecorator.Theme.DEFAULT);
//        decorator.fullBody();

        String log = logged();

        //decorator.setContent(ViewManager.getInstance().get("login"));
        if (log.equals("account") || log.equals("login")) {
            decorator.setContent(ViewManager.getInstance().get(log));
        }

        decorator.getStage().setOnCloseRequest(event -> {
            App.getAdminDetail().getPopOver().hide();
            if(Main.popConfig.isShowing()) Main.popConfig.hide();
            if(Main.popup.isShowing()) Main.popup.hide();
            Platform.exit();
        });
    }
```

我们重点看第9行的代码，可以看到这个代码调用了logged()方法，而这个方法会返回一个内容为login的字符串赋值给log，接着就会对log进行判断，判断的代码在第12行，然后进入第13行代码，这行代码会从Map中去获得对应的界面，通过传入的登录界面的字符串内容来获得我们所需要的登录界面，登录界面我们上面说过之前就已经加载到Map中去了，因此可以取到

这里取到登录界面之后传给setContent，然后通过decorator将其展示出来，展示出来之后我们就可以看到登录的界面了

那我们都知道我们进入登录界面之后我们可以输入用户名和密码，那这些输入在源码里的情况是怎么样的呢？我们不妨进入login.fxml文件中看看其源码

```javascript
<?xml version="1.0" encoding="UTF-8"?>

<?import com.gn.GNAvatarView?>
<?import java.lang.String?>
<?import java.net.URL?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Hyperlink?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.PasswordField?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.effect.DropShadow?>
<?import javafx.scene.image.Image?>
<?import javafx.scene.layout.FlowPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.shape.SVGPath?>

<StackPane prefHeight="601.0" prefWidth="1004.0" xmlns="http://javafx.com/javafx/8.0.171" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.bjpowernode.module.login.Login">
    <stylesheets>
        <URL value="@../../theme/css/material-color.css" />
        <URL value="@../../theme/css/skeleton.css" />
        <URL value="@../../theme/css/light.css" />
        <URL value="@../../theme/css/bootstrap.css" />
        <URL value="@../../theme/css/shape.css" />
        <URL value="@../../theme/css/typographic.css" />
        <URL value="@../../theme/css/helpers.css" />
        <URL value="@../../theme/css/master.css" />
        <URL value="@../../theme/css/login.css" />
    </stylesheets>
   <padding>
      <Insets bottom="20.0" left="50.0" right="50.0" top="20.0" />
   </padding>
   <children>
      <VBox alignment="BOTTOM_RIGHT" prefHeight="200.0" prefWidth="100.0">
         <children>
            <FlowPane alignment="CENTER" columnHalignment="CENTER" prefHeight="455.0" prefWidth="586.0" VBox.vgrow="ALWAYS">
               <children>
                  <HBox prefHeight="439.0" prefWidth="726.0">
                     <children>
                        <HBox alignment="CENTER" prefHeight="437.0" prefWidth="544.0" spacing="40.0" styleClass="teste">
                           <children>
                              <GNAvatarView fx:id="avatar" strokeWidth="0.0">
                                 <image>
                                    <Image url="@../media/logo-mini.png" />
                                 </image>
                                 <effect>
                                    <DropShadow color="#00000035" />
                                 </effect>
                              </GNAvatarView>
                              <Separator orientation="VERTICAL" prefHeight="200.0" />
                              <VBox alignment="CENTER" prefHeight="347.0" prefWidth="297.0" spacing="20.0">
                                 <children>
                                    <Label prefHeight="49.0" prefWidth="79.0" style="-fx-text-fill: -text-color;" styleClass="h2" text="登录">
                                       <VBox.margin>
                                          <Insets top="10.0" />
                                       </VBox.margin>
                                    </Label>
                                    <HBox fx:id="box_username" alignment="CENTER_RIGHT" prefHeight="50.0">
                                       <children>
                                          <SVGPath content="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z" scaleX="1.3" scaleY="1.3" strokeWidth="2.0" style="-fx-fill: -icon-color;" />
                                          <TextField fx:id="username" prefHeight="36.0" prefWidth="230.0" promptText="用户名" styleClass="clearable-field" />
                                       </children>
                                       <styleClass>
                                          <String fx:value="box-light" />
                                          <String fx:value="rounded" />
                                       </styleClass>
                                       <VBox.margin>
                                          <Insets />
                                       </VBox.margin>
                                       <padding>
                                          <Insets right="10.0" />
                                       </padding>
                                    </HBox>
                                    <HBox fx:id="box_password" alignment="CENTER_RIGHT" prefHeight="50.0">
                                       <children>
                                          <SVGPath content="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z" scaleX="1.3" scaleY="1.3" strokeWidth="2.0" style="-fx-fill: -icon-color;" />
                                          <PasswordField fx:id="password" prefHeight="38.0" prefWidth="230.0" promptText="密码" styleClass="viewer-field" />
                                       </children>
                                       <styleClass>
                                          <String fx:value="box-light" />
                                          <String fx:value="rounded" />
                                       </styleClass>
                                       <padding>
                                          <Insets right="10.0" />
                                       </padding>
                                    </HBox>
                                    <Button fx:id="login" defaultButton="true" mnemonicParsing="false" onAction="#loginAction" prefWidth="322.0" text="登录">
                                       <styleClass>
                                          <String fx:value="btn-large" />
                                          <String fx:value="login" />
                                       </styleClass>
                                    </Button>
                                    <Label fx:id="lbl_error" styleClass="text-danger" text="用户名或密码不对." visible="false" />
                                 </children>
                              </VBox>
                           </children>
                        </HBox>
                        <VBox prefHeight="437.0" prefWidth="111.0" spacing="20.0">
                           <children>
                              <Label fx:id="lbl_username" prefHeight="50.0" styleClass="text-danger" text="用户名无效" visible="false" />
                              <Label fx:id="lbl_password" layoutX="10.0" layoutY="10.0" prefHeight="50.0" styleClass="text-danger" text="密码无效" visible="false" />
                           </children>
                           <padding>
                              <Insets left="10.0" top="120.0" />
                           </padding></VBox>
                     </children>
                  </HBox>
               </children>
            </FlowPane>
            <Hyperlink alignment="CENTER_RIGHT" contentDisplay="RIGHT" onMouseClicked="#switchCreate" text="创建用户">
               <graphic>
                  <SVGPath content="M16.01 11H4v2h12.01v3L20 12l-3.99-4z" />
               </graphic>
            </Hyperlink>
         </children>
      </VBox>
   </children>
</StackPane>

```

我们可以看到第64行，我们在第64行里写了用户名，那么用户名这个字符串就会在对应的账号框中展示，然后在第80行还有一个密码，也是一个道理，我们可以看到无论是账号还是密码都是写在promptText属性上的，那么这里我们也可以知道这个属性的作用是什么了，这个属性的作用就是在对应的框中展示我们要给用户看的提示文本

我们继续看可以看到我们的第64行的标签是TextField，这个标签对应的就是输入框，而第80行的PasswordField则是密码框，这也说明我们的两个框是独立的，给这两个框里做个不同的处理，所以我们的账号框是可以看见输入内容的，而密码框则不行，这是因为我们在对应标签里做了不同的处理

然后我们可以看到在TextField和PasswordField中都有id这个属性，这个属性后面我们要用，这里姑且先记一记

接着我们来讲登录功能的实现，为什么我们点击登录按钮就可以实现登录呢？这里我们就要看到第90行Button这个标签，在文本处能看到登录，说明的确是对应开始界面中的登录，然后我们可以看到在这个标签里有这样的属性

```javascript
onAction="#loginAction"
```

这个属性存在的意义是当我们点击登录按钮之后，代码就会通过这个属性调用对应的方法，这个方法是哪里的方法？其实就是login类中的方法

其实每一个fxml文件都有一个对应的class字节码文件，请看下面的代码

```javascript
<StackPane prefHeight="601.0" prefWidth="1004.0" xmlns="http://javafx.com/javafx/8.0.171" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.bjpowernode.module.login.Login">
```

每一个fxml文件都通过controller属性＋对应字节码文件具体路径的方式来讲文件引入对应的字节码文件，这样我们就可以在fxml文件中构造对应的代码来执行对应字节码文件中的方法，比如说，我们这里点进去loginAction方法中，可以看到如下源码

```javascript
/*
    登录
 */
@FXML
private void loginAction(){
    Pulse pulse = new Pulse(login);
    pulse.setDelay(Duration.millis(20));
    pulse.play();
    if(validPassword() && validUsername())
        enter();
    else {
        lbl_password.setVisible(true);
        lbl_username.setVisible(true);
    }
}
```

我们点击登录按钮，就相当于是在执行这个方法，也就是会执行这个方法里的代码，在这里方法里我们可以看到第9行判断语句，其首先判断用户名和密码是否合法，如果合法的话则进入enter()方法，我们来看看该方法的代码

```javascript
private void enter() {
    AdminService adminService = new AdminServiceImpl();
    Admin admin = adminService.get(username.getText());

    //检查是否输入了正确的用户名和密码
    if(admin.getUserName().equals(this.username.getText()) && admin.getPassword().equals(this.password.getText())){
        Section section = new Section();
        section.setLogged(true);
        section.setUserLogged(this.username.getText());
        SectionManager.save(section);

        App.decorator.setContent(ViewManager.getInstance().get("main"));
```

下面其实还有代码，但是这里就省略了

我们可以看到进入这个方法里先new了一个AdminService对象，这个对象里有get方法，get

方法的作用是根据你传入的用户名，在adminService里寻找符合的数据，然后将其作为返回值赋予Admin，此时username.getText()方法代表我们取出用户输入的用户名，这个整个代码的意思是我们传入用户输入的用户名，然后在adminService对象中寻找是否有对应的用户名，若有则返回该数据对象，为了加深理解，我们不妨进入get方法里看看

```javascript
/*
    根据用户名获取用户数据
 */
public Admin get(String name) {
    try {
        File file = new File("admin/" + name + ".properties");
        Properties properties = new Properties();

        FileInputStream inputStream = new FileInputStream(file);
        properties.load(inputStream);
        Admin admin = new Admin();
        admin.setUserName(name);
        admin.setPassword(properties.getProperty("password"));
        return admin;
    } catch (IOException e) {
        e.printStackTrace();
        return null;
    }
}
```

我们可以看到这个get方法里会先创建一个文件对象（第6行）

然后在文件中找对应的用户名和密码并赋予给admin对象（第12、13行），接着返回这个admin对象，如果找不到就抛出异常

这里我们首先要关注的第一件事情是，第6行代码，其寻找的文件的路径究竟是在哪里呢？其实就在我们当初导入的包内的一个叫admin的文件夹中，里面会有各个properties对象，有多少个取决于你创建了几个账户，如下所示

![](D:/Rolin的学习笔记/youdaonote-pull/youdaonote/youdaonote-images/WEBRESOURCEe67ba40634432e17325798a9df7b2e1a.png)

具体进入admin的文本中，可以看到下面的内容

#Update Section


#Thu Jan 27 13:11:40 CST 2022


password=admin


可以看到，文本中记录了密码admin，还有创建该用户对象的时间

那么这个get方法总而言之，其作用就是在admin的文件夹中查找对应的字符串和密码，然后设置给admin对象并将该设置好的对象返回，接着我们继续来看enter方法

```javascript
private void enter() {
    AdminService adminService = new AdminServiceImpl();
    Admin admin = adminService.get(username.getText());

    //检查是否输入了正确的用户名和密码
    if(admin.getUserName().equals(this.username.getText()) && admin.getPassword().equals(this.password.getText())){
        Section section = new Section();
        section.setLogged(true);
        section.setUserLogged(this.username.getText());
        SectionManager.save(section);

        App.decorator.setContent(ViewManager.getInstance().get("main"));
```

返回了之后那么就要检查是否衰弱了正确的用户名和密码，这里就是拿用户输出的用户名和密码和我们之前保存的用户名和密码进行比对，如果全对了那么就说明输入的用户名和密码是正确的，此时我们就进入程序，反之则说明是错误的，不进入程序

那么这里还有一个问题，就是用户输入的用户名和密码我们是怎么获取到的呢？

还记得我们之前讲的ID属性的内容吗？这里我们就要用到这部分内容了

在64行里有先用户名的id属性

```javascript
<TextField fx:id="username"
```

在80行里有密码的id属性

```javascript
<PasswordField fx:id="password"
```

我们点进去会发现其对应的是login类里的成员变量

```javascript
@FXML private TextField username;
@FXML private TextField password;
```

这里通过注解的方式将该成员变量与fxml文件联系起来，也就是说用户输入的用户名和密码会存储到login类中，当然其类型是TextField，然后我们就可以通过获取login的成员变量的方式来获取用户所输入的用户名和密码

最后我们来看看enter方法里的这一行代码，这行代码的主要作用是从Map集合中获取到用户的主界面，在我们确定到用户的用户名和密码都输入无误之后，我们自然要将登录界面跳转到用户界面，这跳转界面的原理是从Map集合中取出预先存放的用户界面并展示出来，这里依赖的就是这一行代码

```javascript
        App.decorator.setContent(ViewManager.getInstance().get("main"));
```

那么到此为止，我们登录的原理的代码就分析完毕了，剩下的就不再继续看了